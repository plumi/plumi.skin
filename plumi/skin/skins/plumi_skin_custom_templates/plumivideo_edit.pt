<html xmlns="http://www.w3.org/1999/xhtml"
	      xml:lang="en"
	      lang="en"
	      xmlns:tal="http://xml.zope.org/namespaces/tal"
	      xmlns:metal="http://xml.zope.org/namespaces/metal"
	      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
	      i18n:domain="plone">
	  <head><title></title></head>
	  <body>
    <div metal:define-macro="header" style="padding-left:10px;">
      <metal:block define-slot="title">
        <h1 i18n:translate="heading_add_item" class="documentFirstHeading"
            tal:condition="python:context.checkCreationFlag()">
          Add
          <span i18n:name="itemtype"
                tal:define="fti python:here.portal_types.getTypeInfo(here)">
            <span i18n:translate=""
                  tal:content="fti/Title"
                  tal:omit-tag="">Item type</span>
          </span>
        </h1>
        <h1 i18n:translate="heading_edit_item" class="documentFirstHeading"
            tal:condition="python: not context.checkCreationFlag()">
          Edit
          <span i18n:name="itemtype"
                tal:define="fti python:here.portal_types.getTypeInfo(here)">
             <span i18n:translate=""
                   tal:content="fti/Title"
                   tal:omit-tag="">Item type</span>
          </span>
        </h1>

<dl class="portalMessage info"
    tal:condition="here/@@plone/isDefaultPageInFolder">
    <dt i18n:translate="">
        Info
    </dt>
    <dd i18n:translate="label_edit_default_view_container">
        You are editing the default view of a container. If you wanted to edit the container itself,
       <a href=""
          i18n:name="go_here"
          i18n:translate="label_edit_default_view_container_go_here"
          tal:attributes="href string:${context/aq_inner/aq_parent/absolute_url}/edit">go here</a>.
    </dd>
</dl>

       </metal:block>


      <metal:block define-slot="extra_info" />

    </div>
   <div metal:define-macro="body"
         style="padding-left:10px;"
         tal:condition="not:isLocked"
         tal:define="lang_name nocall:here/portal_languages/getNameForLanguageCode;
                     portal_type portal_type|string:unknowntype;">
         
      <form name="edit_form"
            method="post"
            enctype="multipart/form-data"
            class="enableUnloadProtection enableAutoFocus atBaseEditForm"
            action=""
            id=""
            tal:define="fieldsets python:['default','categorization','thumbnail']"
            tal:attributes="action python:here.absolute_url()+'/'+template.id;
                            id string:${portal_type}-base-edit;
                            class python:test(path('allow_tabbing|nothing'), 'enableUnloadProtection enableAutoFocus enableFormTabbing enableUnlockProtection', 'enableUnloadProtection enableAutoFocus enableUnlockProtection');">



          <metal:block define-slot="extra_top" />                          
                                <p class="documentDescription"                                 
                                   tal:define="lp_translating_from request/lp_translating_from | here/getCanonicalLanguage;
                                               lp_translating_to request/lp_translating_to | here/getLanguage;
                                               langs here/getUntranslatedLanguages"
                                   i18n:translate="description_translating_from_to"
                                   tal:condition="python: lp_translating_from != lp_translating_to">
                                    Translating from
                                    <span i18n:name="from">
                                        <select name="lp_translating_from">
                                            <option selected="selected"
                                                    tal:define="code here/getCanonicalLanguage"
                                                    tal:content="python:lang_name(code)"
                                                    tal:attributes="selected python:lp_translating_from == code;
                                                                    value code">Language</option>
                                            <option tal:repeat="lang langs"
                                                    tal:content="python:lang[1]"
                                                    tal:attributes="selected python:lp_translating_from == lang[0];
                                                                    value python:lang[0]">Language</option>
                                        </select>
                                    </span>
                                    to
                                    <span i18n:name="to">
                                        <select name="lp_translating_to">
                                            <option selected="selected"
                                                    tal:define="code here/getLanguage"
                                                    tal:content="python:lang_name(code)"
                                                    tal:attributes="selected python:lp_translating_to == code;
                                                                    value code">Language</option>
                                            <option tal:repeat="lang langs"
                                                    tal:content="python:lang[1]"
                                                    tal:attributes="selected python:lp_translating_to == lang[0];
                                                                    value python:lang[0]">Language</option>
                                        </select>
                                    </span>
                                    <input type="hidden" name="form_next" value="True" tal:condition="python:fieldset != fieldsets[-1]"/>
                                </p>
          <metal:block define-slot="widgets">
            <tal:tabbed tal:condition="allow_tabbing | nothing">
              <fieldset tal:repeat="fieldset fieldsets"
                        tal:attributes="id string:fieldset-${fieldset}">
                        <strong tal:content="fieldset" />

                        
                <legend id=""
                        tal:content="python: view.getTranslatedSchemaLabel(fieldset)"
                        tal:attributes="id string:fieldsetlegend-${fieldset}" />
                <tal:fields repeat="field python:schematas[fieldset].editableFields(here, visible_only=True)">
		        <tal:licensingfield tal:condition="python:fieldset == 'categorization' and field.repeat.last">
		          <div tal:replace="structure context/@@dc_metadata|nothing" />
                </tal:licensingfield>                
                  <metal:fieldMacro use-macro="python:here.widget(field.getName(), mode='edit')" />
                </tal:fields>

              </fieldset>
            </tal:tabbed>
            <tal:nottabbed tal:condition="not: allow_tabbing | nothing">
      <div id="archetypes-schemata-links" 
           tal:condition="fieldsets">
        <tal:block repeat="set fieldsets">
          <tal:current condition="python:set == fieldset and fieldsets != ['default']">
		<img tal:attributes="src python:portal_url + '/++resource++plumi.skin.images/step%d' % (1+repeat['set'].index) + '_on.gif'" /> 
          </tal:current>
          <tal:others condition="python:set != fieldset">
		<img tal:attributes="src python:portal_url + '/++resource++plumi.skin.images/step%d' % (1+repeat['set'].index) + '_off.gif'" /> 
          </tal:others>
        </tal:block>
      </div>            
                <tal:fields repeat="field python:schematas[fieldset].editableFields(here, visible_only=True)"> 
                    <tal:norel condition="python:field.getName()!='relatedItems'">    
                      <metal:fieldMacro use-macro="python:here.widget(field.getName(), mode='edit')" />
                    </tal:norel>  
            		<tal:licensingfield tal:condition="python:fieldset == 'categorization' and repeat['field'].end">
            		  <div tal:replace="structure context/@@dc_metadata|nothing" />
            		  <metal:fieldMacro use-macro="python:here.widget('relatedItems', mode='edit')" />
					  <br />
                    </tal:licensingfield>                      
                </tal:fields>

            </tal:nottabbed>
          </metal:block>

          <metal:block define-slot="extra_bottom" />

          <div class="formControls">

            <input type="hidden"
                   name="fieldset"
                   value="default"
                   tal:attributes="value fieldset"
                   />
            <input type="hidden"
                   name="form.submitted"
                   value="1"
                   />
            <input type="hidden"
                   name="add_reference.field:record"
                   value=""
                   />
            <input type="hidden"
                   name="add_reference.type:record"
                   value=""
                   />
            <input type="hidden"
                   name="add_reference.destination:record"
                   value=""
                   />

            <tal:env define="env request/controller_state/kwargs">
              <tal:loop repeat="varname python:('reference_source_url', 'reference_source_field', 'reference_source_fieldset')">
                <tal:reference define="items python:env.get(varname, request.get(varname))"
                               condition="items">
                  <input tal:repeat="item items"
                         type="hidden"
                         name="form_env.reference_source_url:list:record"
                         value="value"
                         tal:attributes="value item;
                                         name string:form_env.${varname}:list:record"
                         />
                </tal:reference>
              </tal:loop>
            </tal:env>

            <tal:comment replace="nothing">
              Turn 'persistent_' variables from controller_state persistent
            </tal:comment>
            <tal:env repeat="env request/controller_state/kwargs/items">
              <input type="hidden"
                     name="key"
                     value="value"
                     tal:define="key python:env[0];
                                 value python:env[1]"
                     tal:condition="python:key.startswith('persistent_')"
                     tal:attributes="name string:form_env.${key}:record;
                                     value value"
                     />
            </tal:env>

            <tal:comment replace="nothing">
              Turn 'persistent_' variables from forms (GET/POST) persistent
            </tal:comment>
            <tal:env repeat="env request/form">
              <input type="hidden"
                     name="key"
                     value="value"
                     tal:define="key env;
                                 value request/?env"
                     tal:condition="python:key.startswith('persistent_')"
                     tal:attributes="name string:form_env.${key}:record;
                                     value value"
                     />
            </tal:env>

            <tal:comment replace="nothing">
              Store referrer to remember where to go back
            </tal:comment>
            <input type="hidden"
                   name="last_referer"
                   tal:define="last_referer python:here.session_restore_value('HTTP_REFERER', request.form.get('last_referer', request.get('HTTP_REFERER')))"
                   tal:attributes="value python:(last_referer and '%s/%s' % (here.absolute_url(), template.id) not in last_referer) and last_referer or (here.getParentNode() and here.getParentNode().absolute_url())"
                   />

            <metal:block define-slot="buttons"
                   tal:define="fieldset_index python:fieldsets.index(fieldset);
                               n_fieldsets python:len(fieldsets)">

                <input tal:condition="python:fieldset_index &gt; 0"
                       class="context"
                       type="submit"
                       name="form.button.previous"
                       value="Previous"
                       i18n:attributes="value label_previous;"
                       tal:attributes="disabled python:test(isLocked, 'disabled', None);"
                       />
                <input tal:condition="python:not allow_tabbing and (fieldset_index &lt; n_fieldsets - 1)"
                       class="context"
                       type="submit"
                       name="form.button.next"
                       value="Next"
                       i18n:attributes="value label_next;"
                       tal:attributes="disabled python:test(isLocked, 'disabled', None);"
                       />                     
                <tal:con tal:condition="python:fieldset == fieldsets[-1]">
                <input class="context"
                       type="submit"
                       name="form.button.save"
                       value="Save"
                       i18n:attributes="value label_save;"
                       tal:attributes="disabled python:test(isLocked, 'disabled', None);"
                       /></tal:con>

                <input class="standalone"
                       type="submit"
                       name="form.button.cancel"
                       value="Cancel"
                       i18n:attributes="value label_cancel;"
                       />
            </metal:block>

            <metal:block define-slot="extra_buttons" />

          </div>

      </form>

    </div>
	



  </body>

</html>
